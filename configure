#!/usr/bin/python3

import os

from sys import argv
argc: int = len(argv)

DEBUG_FILES: list[str] = ["include/debug.hpp", "scheme/debug.scm"]
CONF_TEMPL: str = """/* THIS FILE WAS GENERATED
BY ./configure, DO NOT MODIFY. */
#pragma once

"""

# Exclusion macros
DEBUG_EXCLUDE:  str = "#define DEBUG_EXCLUDE"
STDLIB_EXCLUDE: str = "#define STDLIB_EXCLUDE"

EXCLUDE_ALL = "\n".join(
    [DEBUG_EXCLUDE, STDLIB_EXCLUDE])

# Initialize debug
def dbginit() -> None:
    for file in DEBUG_FILES:
        with open(file, "w+") as f:
            f.close()

def conf_exclude(exclude: str) -> str:
    match exclude:
        case "debug":
            return DEBUG_EXCLUDE
        case "std":
            return STDLIB_EXCLUDE
        case "all":
            return EXCLUDE_ALL
        case _:
            print("Invalid exclusion.")
            return ""

def confinit() -> None:
    conf: str = CONF_TEMPL
    for flag in argv:
        match flag:
            case "--exclude":
                conf += (conf_exclude(argv[argv.index(flag)+1]) + "\n")
            case "--repl":
                conf += "#define ONLY_REPL\n"
    with open("include/config.hpp", "w") as f:
        f.write(conf)
        
def main() -> None:
    dbginit()
    confinit()

if __name__ == "__main__":
    main()
